var e=Object.defineProperty,r=(r,t,a)=>((r,t,a)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a)(r,"symbol"!=typeof t?t+"":t,a);import{r as t,u as a}from"./chunk-CntFpdkq.js";import{j as i}from"./chunk-4zK531Ye.js";class s{constructor(){r(this,"API_DELAY",1e3)}async login(e){if(await this.simulateApiDelay(),!this.isValidEmail(e.email))throw new Error("Invalid email format");if(e.password.length<6)throw new Error("Password must be at least 6 characters");return{id:"1",email:e.email,isSubscribed:!0,subscriptionPlan:"monthly",subscriptionStatus:"active"}}async register(e){if(await this.simulateApiDelay(),!this.isValidEmail(e.email))throw new Error("Invalid email format");if(e.password.length<6)throw new Error("Password must be at least 6 characters");return{id:"1",email:e.email,isSubscribed:!0,subscriptionPlan:e.plan,subscriptionStatus:"active"}}async logout(){await this.simulateApiDelay()}async refreshToken(){return await this.simulateApiDelay(),"mock-refresh-token"}async simulateApiDelay(){return new Promise(e=>setTimeout(e,this.API_DELAY))}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}}class o{constructor(){r(this,"USER_KEY","netpro_user"),r(this,"TOKEN_KEY","netpro_token")}saveUser(e){try{localStorage.setItem(this.USER_KEY,JSON.stringify(e))}catch(r){}}getUser(){try{const e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}catch(e){return this.removeUser(),null}}removeUser(){localStorage.removeItem(this.USER_KEY)}saveToken(e){try{localStorage.setItem(this.TOKEN_KEY,e)}catch(r){}}getToken(){return localStorage.getItem(this.TOKEN_KEY)}removeToken(){localStorage.removeItem(this.TOKEN_KEY)}}(new Date).toISOString(),(new Date).toISOString();const n=t.createContext(void 0),l=({children:e,apiService:r,storageService:a})=>{const l=t.useMemo(()=>r||new s,[r]),c=t.useMemo(()=>a||new o,[a]),[u,d]=t.useState({user:null,loading:!0,error:null});t.useRef(!1),t.useEffect(()=>{d(e=>({...e,loading:!0}));const e=c.getUser();d(e?r=>({...r,user:e,loading:!1}):e=>({...e,loading:!1}))},[]);const p=t.useCallback(async e=>{d(e=>({...e,loading:!0,error:null}));try{0;const r=await l.login(e);return c.saveUser(r),d(e=>({...e,user:r,loading:!1})),!0}catch(r){const e=r instanceof Error?r.message:"Login failed";return d(r=>({...r,error:e,loading:!1})),!1}},[l,c]),m=t.useCallback(async e=>{d(e=>({...e,loading:!0,error:null}));try{0;const r=await l.register(e);return c.saveUser(r),d(e=>({...e,user:r,loading:!1})),!0}catch(r){const e=r instanceof Error?r.message:"Registration failed";return d(r=>({...r,error:e,loading:!1})),!1}},[l,c]),h=t.useCallback(()=>{c.removeUser(),c.removeToken(),d({user:null,loading:!1,error:null})},[c]),g=t.useMemo(()=>({...u,login:p,register:m,logout:h}),[u,p,m,h]);return i.jsx(n.Provider,{value:g,children:e})},c=()=>{const e=t.useContext(n);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e};class u{static async loginWithEndpoint(e,r,t){try{const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);return{...await a.json(),userType:r}}catch(a){throw new Error("Error al conectar con el servidor. Intenta de nuevo.")}}static mockLoginResponse(e,r){return new Promise(t=>{setTimeout(()=>{t({id:`mock-${r}-${Date.now()}`,email:e.email,name:this.getMockNameByUserType(r),role:this.getRoleByUserType(r),userType:r,isSubscribed:!0,subscriptionPlan:"monthly",subscriptionStatus:"active",createdAt:(new Date).toISOString(),lastLoginAt:(new Date).toISOString()})},500)})}static getMockNameByUserType(e){return{especialista:"Juan Pérez - Técnico HVAC",propietario:"María García - Propietaria",administrador:"Carlos López - Administrador"}[e]}static getRoleByUserType(e){return{especialista:"professional",propietario:"user",administrador:"admin"}[e]}static validateEndpoint(e,r){if(!r)throw new Error(`Endpoint no configurado para el tipo de usuario: ${e}`);try{new URL(r)}catch{throw new Error(`Endpoint inválido para ${e}: ${r}`)}}static getConfiguredEndpoints(){return{especialista:"https://api.netpro.com/v1/login/especialista",propietario:"https://api.netpro.com/v1/login/propietario",administrador:"https://api.netpro.com/v1/login/administrador"}}}const d=()=>{const{login:e,user:r,loading:i}=c(),s=a(),o=t.useCallback(e=>{const r={especialista:"/dashboard/especialista",propietario:"/dashboard/propietario",administrador:"/dashboard/administrador"}[e];s(r||"/calendario",{replace:!0})},[s]),n=t.useCallback(async(r,t,a)=>{try{u.validateEndpoint(t,a);const i={...r,email:r.email},s=await e(i);return s&&setTimeout(()=>{o(t)},100),s}catch(i){return!1}},[e,o]),l=t.useCallback(()=>{(null==r?void 0:r.userType)?o(r.userType):s("/calendario",{replace:!0})},[r,o,s]);return{loginWithUserType:n,redirectByUserType:o,redirectCurrentUser:l,user:r,loading:i}};export{l as A,d as a,c as u};
